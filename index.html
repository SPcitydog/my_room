<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebAR with Hiro + JSON Layout + Box</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true;"
    >
      <!-- 相機 -->
      <a-entity camera></a-entity>

      <!-- Hiro marker（加入紅色方塊） -->
      <a-marker preset="hiro" id="hiroMarker" emitevents="true">
        <!-- 紅色方塊 -->
        <a-box color="red" position="0 0.1 0" depth="0.1" height="0.1" width="0.1"></a-box>
      </a-marker>

      <!-- 所有模型掛載到這裡 -->
      <a-entity id="modelContainer"></a-entity>
    </a-scene>

    <script>
      const marker = document.getElementById("hiroMarker");
      const container = document.getElementById("modelContainer");
      let modelsSpawned = false;

      marker.addEventListener("markerFound", () => {
        if (modelsSpawned) return;
        modelsSpawned = true;

        fetch("ar_scene_layout.json")
          .then((res) => res.json())
          .then((data) => {
            data.objects.forEach((obj) => {
              const el = document.createElement("a-entity");
              el.setAttribute("gltf-model", `url(assets/${obj.model})`);
              el.setAttribute("position", obj.position.join(" "));
              el.setAttribute("rotation", obj.rotation.join(" "));
              el.setAttribute("scale", obj.scale.join(" "));
              el.setAttribute("animation-mixer", "");
              container.appendChild(el);
            });
          });
      });
    </script>
  </body>
</html>
