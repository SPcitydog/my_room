<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebAR: Hiro + Persist Model</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }

      /* ÁâàÊú¨ËôüÈ°ØÁ§∫ÂçÄ */
      #versionTag {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        padding: 6px 10px;
        font-family: monospace;
        font-size: 14px;
        z-index: 9999;
        text-align: left;
      }
    </style>
  </head>
  <body>

    <!-- ‚úÖ È°ØÁ§∫ÁâàÊú¨ËôüÁ¢º -->
    <div id="versionTag">üîß Ê∏¨Ë©¶Áâà v0.9.2 - 2024/04/11 - Ê®°Âûã‰∏çË∑ü marker Ê∂àÂ§±</div>

    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true;"
    >
      <a-entity camera></a-entity>

      <!-- Hiro marker -->
      <a-marker preset="hiro" id="hiroMarker" emitevents="true">
        <a-box color="red" position="0 0.1 0" width="0.1" height="0.1" depth="0.1"></a-box>
      </a-marker>

      <!-- ÊåÅ‰πÖÈ°ØÁ§∫Ê®°ÂûãÂÆπÂô® -->
      <a-entity id="modelScene"></a-entity>
    </a-scene>

    <script>
      const marker = document.getElementById("hiroMarker");
      const modelScene = document.getElementById("modelScene");
      let modelsSpawned = false;

      marker.addEventListener("markerFound", () => {
        if (modelsSpawned) return;
        modelsSpawned = true;

        fetch("ar_scene_layout.json")
          .then((res) => res.json())
          .then((data) => {
            data.objects.forEach((obj) => {
              const el = document.createElement("a-entity");
              el.setAttribute("gltf-model", `url(assets/${obj.model})`);
              el.setAttribute("position", obj.position.join(" "));
              el.setAttribute("rotation", obj.rotation.join(" "));
              el.setAttribute("scale", obj.scale.join(" "));
              el.setAttribute("animation-mixer", "");
              modelScene.appendChild(el);
            });
          });
      });
    </script>
  </body>
</html>
